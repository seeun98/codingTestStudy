## [프로그래머스] 자동차 대여 기록 별 대여 금액 구하기
https://school.programmers.co.kr/learn/courses/30/lessons/151141#qna

### SOLUTION
- 1단계 -> 타입이 트럭인 것들 정보
```SQL
SELECT CAR_ID, DAILY_FEE, CAR_TYPE
FROM CAR_RENTAL_COMPANY_CAR
WHERE CAR_TYPE = '트럭'
```

- 2단계 -> 트럭이다/ 대여기간을 만들고 (END-START), DURATION_TYPE과 똑같이 만들 컬럼 하나 더 만들기 CASE WHEN
```SQL
SELECT B.HISTORY_ID, B.CAR_ID, A.CAR_TYPE, A.DAILY_FEE
      ,END_DATE, START_DATE
      ,(END_DATE-START_DATE)+1 AS 대여기간
      ,CASE WHEN ((END_DATE-START_DATE)+1) BETWEEN 7 AND 29 THEN '7일 이상'
            WHEN ((END_DATE-START_DATE)+1) BETWEEN 30 AND 89 THEN '30일 이상'
            WHEN ((END_DATE-START_DATE)+1) >= 90 THEN '90일 이상' ELSE NULL END AS DURATION_TYPE
FROM 
(SELECT CAR_ID, DAILY_FEE, CAR_TYPE
FROM CAR_RENTAL_COMPANY_CAR
WHERE CAR_TYPE = '트럭') A, CAR_RENTAL_COMPANY_RENTAL_HISTORY B
WHERE A.CAR_ID = B.CAR_ID
```

- 3단계 FEE, 대여기간 나오기
```SQL
SELECT A.HISTORY_ID, A.DAILY_FEE, "대여기간"
      ,NVL(B.DISCOUNT_RATE,0) AS DISCOUNT_RATE
FROM (SELECT B.HISTORY_ID, B.CAR_ID, A.CAR_TYPE, A.DAILY_FEE
      ,END_DATE, START_DATE
      ,(END_DATE-START_DATE)+1 AS "대여기간"
      ,CASE WHEN ((END_DATE-START_DATE)+1) BETWEEN 7 AND 29 THEN '7일 이상'
            WHEN ((END_DATE-START_DATE)+1) BETWEEN 30 AND 89 THEN '30일 이상'
            WHEN ((END_DATE-START_DATE)+1) >= 90 THEN '90일 이상' ELSE NULL END AS DURATION_TYPE
FROM 
(SELECT CAR_ID, DAILY_FEE, CAR_TYPE
FROM CAR_RENTAL_COMPANY_CAR
WHERE CAR_TYPE = '트럭') A, CAR_RENTAL_COMPANY_RENTAL_HISTORY B
WHERE A.CAR_ID = B.CAR_ID) A
     LEFT OUTER JOIN (
                     SELECT CAR_TYPE, DURATION_TYPE, DISCOUNT_RATE
                     FROM CAR_RENTAL_COMPANY_DISCOUNT_PLAN
                     WHERE CAR_TYPE = '트럭') B
     ON A.CAR_TYPE = B.CAR_TYPE
     AND A.DURATION_TYPE = B.DURATION_TYPE

```

- 4단계 할인율 계산
```SQL
SELECT HISTORY_ID, ((1-DISCOUNT_RATE/100) * "대여기간" * DAILY_FEE) as FEE
FROM(SELECT A.HISTORY_ID, A.DAILY_FEE, "대여기간"
      ,NVL(B.DISCOUNT_RATE,0) AS DISCOUNT_RATE
FROM (SELECT B.HISTORY_ID, B.CAR_ID, A.CAR_TYPE, A.DAILY_FEE
      ,END_DATE, START_DATE
      ,(END_DATE-START_DATE)+1 AS "대여기간"
      ,CASE WHEN ((END_DATE-START_DATE)+1) BETWEEN 7 AND 29 THEN '7일 이상'
            WHEN ((END_DATE-START_DATE)+1) BETWEEN 30 AND 89 THEN '30일 이상'
            WHEN ((END_DATE-START_DATE)+1) >= 90 THEN '90일 이상' ELSE NULL END AS DURATION_TYPE
FROM 
(SELECT CAR_ID, DAILY_FEE, CAR_TYPE
FROM CAR_RENTAL_COMPANY_CAR
WHERE CAR_TYPE = '트럭') A, CAR_RENTAL_COMPANY_RENTAL_HISTORY B
WHERE A.CAR_ID = B.CAR_ID) A
     LEFT OUTER JOIN (
                     SELECT CAR_TYPE, DURATION_TYPE, DISCOUNT_RATE
                     FROM CAR_RENTAL_COMPANY_DISCOUNT_PLAN
                     WHERE CAR_TYPE = '트럭') B
     ON A.CAR_TYPE = B.CAR_TYPE
     AND A.DURATION_TYPE = B.DURATION_TYPE) C
ORDER BY ((1-DISCOUNT_RATE/100) * 대여기간 * DAILY_FEE) DESC, HISTORY_ID DESC

```